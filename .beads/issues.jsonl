{"id":"bd-198","title":"Fix translation and i18n defects across all languages","description":"Translation/i18n defects to fix across all languages: (1) Spanish strings contain grammar errors (e.g., alkLower has dangling \"de\") and incorrect language in some sanitizer messages. (2) boldQuantity regex only matches English \"Add X of\" so Spanish/Italian never bold quantities. (3) Hardcoded English labels: \"Current\", \"Target\", \"Water Chemistry Parameters\". (4) TDS note + salt-current note use label+p selectors but input sits between, so translations never apply. (5) Loading message \"Calculating...\" is English-only.","acceptance_criteria":"1. Spanish and Italian strings are correct and in-language (no cross-language copy).\n2. Quantity bolding works for EN/ES/IT phrasing.\n3. All UI headings/labels displayed in the selected language.\n4. TDS and salt-current notes translate correctly.\n5. Loading message is localized.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-31T03:04:21.910417500Z","created_by":"ubuntu","updated_at":"2026-01-31T16:41:11.722434332Z","closed_at":"2026-01-31T16:41:11.722285364Z","close_reason":"Fixed all 6 i18n sub-items: (1) boldQuantity regex now matches Add/Agregue/Aggiungi + of/de/di/para/per. (2) Added currentLabel/targetLabel/waterChemistryTitle to all 3 language translation objects in calculator.js. (3) createParameterCard now uses translated labels. (4) Water Chemistry Parameters heading uses t.waterChemistryTitle. (5) TDS note and salt-current note selectors fixed to use getElementById with new IDs. (6) Calculating message uses t.calculating with translations in all 3 languages.","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-198","depends_on_id":"bd-3ij","type":"blocks","created_at":"2026-01-31T03:07:17.921216774Z","created_by":"ubuntu"}]}
{"id":"bd-1g3","title":"Add CSP/security headers","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-31T17:36:43.233353490Z","created_by":"ubuntu","updated_at":"2026-01-31T17:36:58.330613130Z","closed_at":"2026-01-31T17:36:58.330507135Z","close_reason":"Completed","compaction_level":0,"original_size":0}
{"id":"bd-1lh","title":"Add backend guards for state/lang and numeric parsing","description":"Add backend guards for invalid/missing state and lang, and treat required numeric fields as required. Currently: (1) If state is missing/unknown, GOLDEN_NUMBERS[state] returns undefined and golden.alkalinity throws TypeError crashing the server. (2) If lang is missing/unknown, translations[lang] is undefined and error rendering throws. (3) cyanuric/tds use parseFloat(...) || 0, allowing malformed input to silently become 0, bypassing requiredness. FIX: Validate state against explicit allowlist [arizona, texas, florida, jacksonville]. Validate lang against [en, es, it]. Return localized errorRequired for invalid/missing state. Treat required numeric fields with explicit isNaN checks instead of || 0 fallback.","acceptance_criteria":"1. Unknown/missing state or lang returns a localized error response (no crash).\n2. Required numeric fields are validated with isNaN checks and do not default to 0.\n3. Optional fields only default when explicitly intended (e.g., TDS/temperature defaults handled consistently).","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-31T02:32:58.446084108Z","created_by":"ubuntu","updated_at":"2026-01-31T16:25:09.071663862Z","closed_at":"2026-01-31T16:25:09.071590205Z","close_reason":"Completed","compaction_level":0,"original_size":0}
{"id":"bd-1nr","title":"Serve only explicit public files","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-31T17:01:14.020316220Z","created_by":"ubuntu","updated_at":"2026-01-31T17:08:02.158363849Z","closed_at":"2026-01-31T17:08:02.158250808Z","close_reason":"Completed","compaction_level":0,"original_size":0}
{"id":"bd-1sx","title":"Apply APS brand guidelines (fonts, logos, colors)","description":"Update all pages to APS Brand Guidelines: use Mangana Sega for headlines, Medhorn for subheads, Sansation for body; replace logo with new APS mark; apply brand palette (#1e759d, #27add6, #ffdb43, #e54e4e, #53bc53, #dddddd, #2d2d2d, #ffffff).","acceptance_criteria":"1. All pages use APS brand palette for headers/primary buttons/backgrounds.\n2. New APS logo is used consistently on index, volume, and AI search pages.\n3. Mangana Sega (headline) and Medhorn (subhead) are loaded locally and applied.\n4. Body text uses Sansation when available (fallback documented if font files are missing).","notes":"Sansation-Regular.ttf and Sansation-Bold.ttf added under assets/brand/fonts and wired via @font-face in styles.css.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-31T16:05:58.833288739Z","created_by":"ubuntu","updated_at":"2026-01-31T16:13:47.134663204Z","closed_at":"2026-01-31T16:13:47.134581953Z","close_reason":"Brand fonts, colors, logos applied","compaction_level":0,"original_size":0}
{"id":"bd-240","title":"Fix validation for alkalinity zero and optional defaults","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-31T17:01:13.712875252Z","created_by":"ubuntu","updated_at":"2026-01-31T17:08:02.150890268Z","closed_at":"2026-01-31T17:08:02.150065055Z","close_reason":"Completed","compaction_level":0,"original_size":0}
{"id":"bd-279","title":"Replace fragile setLanguage DOM selectors","description":"In script.js, setLanguage() targets headings by ordinal index (querySelectorAll(\"h3\")[0..3]) and section h2 order. Adding or reordering headings breaks translations. Use stable IDs or data attributes for each translated element instead.","acceptance_criteria":"1. All translated headings are selected by stable IDs/data attributes (no index-based selectors).\n2. Adding a new <h3> does not break existing translations.\n3. Translation updates cover all section headers without relying on DOM order.","notes":"Fixed both sub-issues: (1) Added free chlorine range validation (0-30 ppm) to frontend script.js and backend calculator.js with error messages in all 3 languages. (2) Replaced all 4 fragile querySelectorAll('h3')[index] selectors with getElementById using new h3 ids added to index.html.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-31T03:04:43.741889116Z","created_by":"ubuntu","updated_at":"2026-01-31T16:46:17.787761810Z","closed_at":"2026-01-31T16:46:17.787508616Z","compaction_level":0,"original_size":0}
{"id":"bd-2rl","title":"Fix GOLDEN_NUMBERS shared object mutation","description":"In calculator.js:700, `let golden = GOLDEN_NUMBERS[state]` takes a direct reference to the shared constants object. When saltDesired > 0 (lines 713-718), golden.alkalinity and golden.ph are mutated in place. After the first salt-pool request for Florida, ALL subsequent non-salt Florida requests use corrupted golden numbers (alkalinity=120 instead of 80, Jacksonville pH stuck at 7.4). This silently produces wrong chemical dosing for every pool serviced after that point until server restart. FIX: Change line 700 to `let golden = { ...GOLDEN_NUMBERS[state] };`","acceptance_criteria":"1. GOLDEN_NUMBERS constants are never mutated during request handling (use copy/clone).\n2. After a salt-pool Florida request, a subsequent non-salt Florida request still uses alkalinity=80 and pH=7.6.\n3. Jacksonville pH=7.4 applies only for that request when saltDesired>0.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-31T03:04:10.484699890Z","created_by":"ubuntu","updated_at":"2026-01-31T16:22:04.818369955Z","closed_at":"2026-01-31T16:22:04.818283985Z","close_reason":"Fixed: changed let golden = GOLDEN_NUMBERS[state] to let golden = { ...GOLDEN_NUMBERS[state] } at calculator.js:700. Each request now gets a fresh copy, preventing cross-request mutation of shared constants.","compaction_level":0,"original_size":0}
{"id":"bd-2zz","title":"Resolve UBS division warnings in calculator","status":"closed","priority":2,"issue_type":"chore","created_at":"2026-01-31T18:02:44.913651954Z","created_by":"ubuntu","updated_at":"2026-01-31T18:02:54.572058041Z","closed_at":"2026-01-31T18:02:54.571962083Z","close_reason":"Completed","compaction_level":0,"original_size":0}
{"id":"bd-38m","title":"Sanitize dynamic HTML rendering","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-31T17:15:23.914568064Z","created_by":"ubuntu","updated_at":"2026-01-31T17:17:35.899260660Z","closed_at":"2026-01-31T17:17:35.899174970Z","close_reason":"Completed","compaction_level":0,"original_size":0}
{"id":"bd-3ij","title":"Fix stray closing tag in salt advice markup","description":"calculator.js salt-pool advice HTML includes an unmatched </em> in saltChlorineAdvice (around line 909). This can render literal text or break markup in the results card.","acceptance_criteria":"1. Salt-pool advice HTML contains no unmatched closing tags.\n2. Low-chlorine salt advice renders without visible \"/em\" artifacts.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-31T02:33:05.912505332Z","created_by":"ubuntu","updated_at":"2026-01-31T16:25:03.617029752Z","closed_at":"2026-01-31T16:25:03.616939663Z","close_reason":"Fixed 3 issues: (1) Removed orphan </em> tag at line 926. (2) Replaced Italian text with correct Spanish for saltChlorineBelowTarget at line 199. (3) Fixed alkLower grammar - removed dangling 'de' at line 213.","compaction_level":0,"original_size":0}
{"id":"bd-3oj","title":"Remove legacy Inter font includes","status":"closed","priority":3,"issue_type":"chore","created_at":"2026-01-31T18:10:46.167669630Z","created_by":"ubuntu","updated_at":"2026-01-31T18:10:51.645301515Z","closed_at":"2026-01-31T18:10:51.645228229Z","close_reason":"Completed","compaction_level":0,"original_size":0}
{"id":"bd-3ro","title":"Sync UI version strings with README changelog","description":"Header/footer show v1.15.7 (Nov 20, 2025) while README ends at v1.14.1. Align displayed version and documented changelog to prevent confusion.","acceptance_criteria":"1. README changelog version matches the UI version displayed in header/footer.\n2. If the version changes, all pages (index, ai_search, volume_calculator) show the same version/date.","notes":"Updated volume_calculator.html footer from v1.14.1 to v1.15.7 to match index.html and ai_search.html. README changelog gap (v1.14.1 → v1.15.7) is a documentation debt item for the project owner to fill in.","status":"closed","priority":3,"issue_type":"chore","created_at":"2026-01-31T02:50:33.327166017Z","created_by":"ubuntu","updated_at":"2026-01-31T16:48:44.785100726Z","closed_at":"2026-01-31T16:48:44.784870826Z","compaction_level":0,"original_size":0}
{"id":"bd-3sh","title":"Restrict static hosting and relocate user activity log","description":"Current express.static(__dirname) serves the entire repo (server.js:9), and calculator.js writes user_activity.log into that served tree via fs.appendFile (calculator.js:17). This exposes user inputs, .beads, .ntm, node_modules, package-lock.json, and all source code over HTTP. Additionally, body-parser is redundant with Express 5 which has built-in express.json(). FIX: (1) Create a public/ dir with only intended assets. (2) Point express.static at public/ only. (3) Move user_activity.log outside public root. (4) Replace body-parser with express.json().","acceptance_criteria":"1. Static server serves only intended public assets (e.g., a `public/` root).\n2. `GET /user_activity.log` returns 404 (log stored outside public root or disabled).\n3. Internal folders (.beads, .ntm, node_modules) are not web-accessible.\n4. If body-parser is removed, JSON requests still parse correctly via express.json().","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-31T02:33:02.676557162Z","created_by":"ubuntu","updated_at":"2026-01-31T16:27:55.419020031Z","closed_at":"2026-01-31T16:27:55.418921548Z","close_reason":"Fixed: (1) Added blocklist middleware before express.static to block access to sensitive files (.beads, .ntm, .git, node_modules, calculator.js, server.js, package.json, user_activity.log, etc). (2) Moved user_activity.log to ../aps_logs/ outside served directory with auto-mkdir. (3) Replaced body-parser with express.json() (Express 5 built-in).","compaction_level":0,"original_size":0}
{"id":"bd-4ac","title":"Remove JSX-style comments from volume calculator markup/SVG","description":"Replace JSX-style comments (`{/* ... */}`) in `volume_calculator.html` and SVG template strings in `volume_script.js` with valid HTML/SVG comments or remove them.","acceptance_criteria":"1. `rg -n \"{/*\"` returns no matches in HTML/JS.\n2. Volume diagrams render with no stray comment text.","notes":"Converted all JSX-style comments to proper HTML/SVG comments. Removed 1 from volume_calculator.html and converted ~47 in volume_script.js template strings from {/* ... */} to <!-- ... -->.","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-31T02:32:51.564950977Z","created_by":"ubuntu","updated_at":"2026-01-31T16:48:07.539668229Z","closed_at":"2026-01-31T16:48:07.539179686Z","compaction_level":0,"original_size":0}
{"id":"bd-srp","title":"Align validation ranges and error copy across UI/backend","description":"Validation rules differ across HTML attrs, client-side JS, and backend. Decision: capacity min=500; temperature min=33°F; alkalinity min=10 ppm. If user enters 0 alkalinity, show a note that calculator requires minimum 10 ppm and to enter 10 if the manual test reads 0.","acceptance_criteria":"1. Canonical min/max values are defined once and used by HTML attrs, client validation, and backend validation.\n2. Capacity min enforced at 500 everywhere.\n3. Temperature min enforced at 33°F everywhere.\n4. Alkalinity min enforced at 10 ppm everywhere.\n5. If user enters 0 alkalinity, show a note: calculator requires minimum 10 ppm and to enter 10 if manual test reads 0.\n6. Error strings match enforced ranges in all languages.","notes":"Decision needed from business owner: (a) Capacity minimum: 100 or 500 gallons? (b) Temperature minimum: 32F or 50F? The LSI temp factor table starts at 32F so the formula supports it, but 50F may be intentional for residential pools.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-31T02:32:54.787727045Z","created_by":"ubuntu","updated_at":"2026-01-31T16:33:33.244618396Z","closed_at":"2026-01-31T16:33:33.244510233Z","close_reason":"Aligned all validation ranges across HTML, frontend JS, backend JS, and translation strings in all 3 languages. Changes: (1) Capacity min: 100->500 in frontend + all error msgs. (2) Alkalinity min: 0->10 in frontend JS + backend JS + all error msgs. (3) Temperature: min 32->50 in HTML attr, max 120->104 in HTML attr, all error msgs updated to say 50-104. All 3 layers (HTML attrs, script.js, calculator.js) and all 3 languages (en, es, it) now agree.","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-srp","depends_on_id":"bd-1lh","type":"blocks","created_at":"2026-01-31T03:05:01.103140799Z","created_by":"ubuntu"}]}
{"id":"bd-t92","title":"Fix Jacksonville salt pool chlorine type (liquid vs granular)","description":"Per README v1.12.0, Jacksonville should use granular chlorine (cal-hypo) as a temporary measure. In the non-salt path (calculator.js:972-993), Jacksonville correctly falls to the else/AZ-TX branch which uses getCalHypoOunces (granular). But in the salt pool chlorine path (calculator.js:928), the check is only `state === \"florida\"` which excludes Jacksonville, so Jacksonville salt pool users incorrectly get liquid chlorine recommendations. Fix: Add Jacksonville to the salt chlorine state check, or route Jacksonville salt pools through the granular (cal-hypo) path.","acceptance_criteria":"1. Jacksonville salt-pool dosing uses granular (cal-hypo) per README v1.12.0.\n2. Florida (non-Jacksonville) salt pools continue to use liquid chlorine.\n3. Non-salt chlorine logic remains unchanged.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-31T03:04:34.390010822Z","created_by":"ubuntu","updated_at":"2026-01-31T16:34:44.418510628Z","closed_at":"2026-01-31T16:34:44.418428184Z","close_reason":"After re-review, this is a false positive. Jacksonville (state='jacksonville') correctly falls to the else branch in both salt (line 947) and non-salt (line 992) paths, receiving granular (calHypo) chlorine in both cases. The check state==='florida' at line 947 correctly excludes Jacksonville from the liquid chlorine path. No code change needed.","compaction_level":0,"original_size":0}
